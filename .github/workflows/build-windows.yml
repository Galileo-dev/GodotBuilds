name: "Create weekly build"
on:
  # schedule:
  #   - cron: "0 0 * * *"
  push

jobs:
  build:
    name: Build
    runs-on: windows-latest
    steps:
      # - name: Checkout code
      #   uses: actions/checkout@v2
      #   with:
      #     repository: "godotengine/godot"
      #     token:
      #       ${{ secrets.GITHUB_TOKEN }}
      #       # Make sure the actual branch is checked out when running on pull requests
      #     ref: ${{ github.head_ref }}
      #     # This is important to fetch the changes to the previous commit
      #     fetch-depth: 0
      #     clean: "false"

      # - name: get scripts
      # run: |
      #   git clone https://github.com/Galileo-dev/GodotBuilds temp
      #   cp -a ./temp/. ./
      #   ls
      #   godot_version=$(python version.py)
      #   echo "godot_version=${godot_version}"  >> $GITHUB_ENV

      #   # robocopy .\temp\ .\ /E
      #   # del temp /q

      # - name: Set up MinGW
      #   if: runner.os == 'Linux'
      #   uses: egor-tensin/setup-mingw@v2
      #   with:
      #     platform: x64

      # - name: Install Other Linux Dependencies
      #   if: runner.os == 'Linux'
      #   run: |
      #     sudo apt-get update -y
      #     sudo apt-get install -y python3 scons
      #     ls

      - name: Install MSVC
        if: runner.os == 'Windows'
        uses: ilammy/msvc-dev-cmd@v1

      - name: Install Python
        uses: actions/setup-python@v2
        with:
          python-version: "3.x" # Version range or exact version of a Python version to use, using SemVer's version range syntax
          architecture: "x64" # optional x64 or x86. Defaults to x64 if not specified

      - name: Install Scons
        run: python -m pip install scons

      # - name: Install Choco
      #   uses: crazy-max/ghaction-chocolatey@v1
      #   with:
      #     args: install make yasm --no-progress

      # - name: Install Scoop
      #   if: runner.os == 'Windows'
      #   run: |
      #     Invoke-Expression (New-Object System.Net.WebClient).DownloadString('https://get.scoop.sh')
      #     scoop install python yasm make
      #     dir
      #     scoop install scons
      #     scons -j6 platform=windows target=release_debug

      # - run: ls
      - name: Build GODOT
        run: scons

      # - name: Compress binaries
      #   uses: edgarrc/action-7z@v1
      #   with:
      #     args: 7z a -t7z -mx=9 godot.7z ./tests/
      # - run: ls
      # - name: Upload binaries to release

      #   uses: svenstaro/upload-release-action@v2
      #   with:
      #     repo_token: ${{ secrets.GITHUB_TOKEN }}
      #     file: bin
      #     asset_name: mything
      #     tag: ${{ github.ref }}
      #     overwrite: true
      #     body: "This is my release text"
